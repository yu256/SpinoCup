package app

import Game.gameView
import com.raquo.laminar.api.L.*
import org.scalajs.dom

@main def main(): Unit =
  lazy val appContainer = dom.document.querySelector("#app")
  renderOnDomContentLoaded(appContainer, app)

lazy val app =
  var gooAppId = ""
  var chainLen = 10
  var toLearnText =
    "暑すぎて溶けそうだ。暑すぎてアイスがすぐ溶ける。暑すぎてクーラーがないと耐えられない。暑すぎて外に出たくない。暑すぎて眠れない夜が続いている。暑すぎてエアコンの電気代が心配だ。暑すぎて日焼け止めが欠かせない。暑すぎて植物が枯れてしまった。暑すぎて外のアスファルトが溶けそうだ。暑すぎて冷たい飲み物が手放せない。暑すぎて仕事に集中できない。暑すぎてパソコンが熱暴走しそうだ。暑すぎて汗が止まらない。暑すぎてうちの猫もぐったりしている。暑すぎてシャワーを何回も浴びたくなる。暑すぎてビーチに行きたくなる。暑すぎてプールが恋しい。暑すぎて山の涼しい場所に行きたい。暑すぎてエアコンの効いたカフェに避難した。暑すぎて夕方でも日差しが強い。暑すぎて扇風機じゃ足りない。暑すぎて帽子をかぶらないと頭が痛くなる。暑すぎて靴がベタベタする。暑すぎて寝汗がひどい。暑すぎて髪がべたつく。暑すぎて冷やし中華を作った。暑すぎてうちの犬が水を飲みまくっている。暑すぎて公園の遊具が熱くて触れない。暑すぎて自販機で冷たい飲み物を大量に買った。暑すぎてお風呂が逆に気持ちいい。暑すぎてタオルが手放せない。暑すぎて冷房の温度を下げすぎてしまう。暑すぎて夜の風がほとんど涼しくない。暑すぎて道路が蜃気楼みたいになっている。暑すぎてサングラスが必需品だ。暑すぎてスイカが美味しい。暑すぎてかき氷が食べたくなる。暑すぎて扇風機が回りっぱなしだ。暑すぎてシャツが汗でびしょびしょだ。暑すぎて寝室の窓を開けっ放しにした。暑すぎてフローズンドリンクが飲みたくなる。暑すぎて早朝しか散歩できない。暑すぎてトンボが見当たらない。暑すぎてサボテンですら元気がない。暑すぎて夜になっても気温が下がらない。暑すぎてプールに飛び込みたい気分だ。暑すぎて冷却シートをおでこに貼った。暑すぎてアイスのストックがすぐになくなる。暑すぎてアイスコーヒーが必須だ。暑すぎて朝顔がしおれてしまった。暑すぎて麦わら帽子が欠かせない。暑すぎてセミの声がさらにうるさく感じる。暑すぎて家にいるのが一番快適だ。暑すぎて水筒が空っぽになる。暑すぎて涼しい映画館で過ごしたくなる。暑すぎて夜中にクーラーをつけっぱなしにした。暑すぎてランニングがきつい。暑すぎて車の中がサウナ状態だ。暑すぎてアイスを食べる手が止まらない。暑すぎて蚊取り線香が必需品だ。暑すぎて風鈴の音が心地よい。暑すぎて日陰がまるでオアシスのようだ。暑すぎて路面が焼けてる。暑すぎて日傘が必要だ。暑すぎて体がだるい。暑すぎて汗が目に入って痛い。暑すぎて海に行くしかない。暑すぎてアイスクリームを毎日食べている。暑すぎて運動する気になれない。暑すぎて体調を崩しそうだ。暑すぎて飲み物がすぐぬるくなる。暑すぎて冷たいタオルが大活躍。暑すぎてベランダで植物を育てられない。暑すぎてドリンクバーに通いたい。暑すぎてお風呂のお湯がいらない。暑すぎて朝からエアコンをつけっぱなしだ。暑すぎてフルーツが腐りやすい。暑すぎて洗濯物がすぐ乾く。暑すぎてエアコンなしでは無理だ。暑すぎて氷を買い足した。暑すぎて外食する気力がわかない。暑すぎて花火大会が待ち遠しい。暑すぎて日が沈むのが遅く感じる。暑すぎてひんやりマットが大活躍。暑すぎて涼しい場所が限られている。暑すぎてビールが美味しい。暑すぎて砂浜が焼けている。暑すぎて街の噴水に人が集まっている。暑すぎてエアコンの効いた電車が快適だ。暑すぎてランチはさっぱりしたものを選んでしまう。暑すぎて冷えピタが手放せない。暑すぎて氷枕を使い始めた。暑すぎて植物に毎日水やりが必要だ。暑すぎて外でスポーツするのは危険だ。暑すぎて熱中症が心配だ。暑すぎてガーデニングができない。暑すぎてエアコンの効いたスーパーが涼しい。暑すぎて公園に誰もいない。暑すぎて自転車に乗るのがつらい。暑すぎて外の風が温風に感じる。厚い本を読むのに時間がかかる。厚手のコートを着ると冬でも暖かい。厚焼き卵がふわふわで美味しい。熱いお茶が体を温めてくれる。厚切りベーコンがジューシーで最高だ。熱心に勉強する学生が増えている。熱が出たので学校を休んだ。厚い布団で寒い夜を乗り切る。熱気がこもって部屋がむっとする。熱いシャワーが心地よい。厚化粧が苦手だという人もいる。熱中症に気をつけて水分補給をしっかりしよう。厚い雲が空を覆っている。熱帯夜が続いて寝苦しい。厚みのあるステーキが食べたい。熱いスープが冷えた体に染み渡る。厚手のタオルがふんわりしていて気持ちいい。熱気球に乗って空を飛んでみたい。熱い砂浜で足が焼けるようだ。厚かましいお願いをしてしまった。熱風が顔に当たってきつい。厚生労働省が新しいガイドラインを発表した。熱帯魚の水槽を掃除するのが楽しい。厚いドアが外の音を遮ってくれる。熱々の鍋料理が恋しい季節。厚紙で作ったカードが丈夫だ。熱々の鉄板で焼いたステーキが美味しい。厚い友情で結ばれている。熱血教師が学生を熱心に指導する。厚底の靴を履いて背が高く見える。熱心にスポーツに打ち込む選手。厚めのマットレスが腰に優しい。熱がこもりやすい場所は避けるべきだ。厚切りトーストにバターを塗る。熱狂的なファンがコンサートに集まる。厚顔無恥な態度に驚いた。熱湯でカップラーメンを作る。厚い氷が川を覆っている。熱帯地域の植物が美しい。厚い絨毯の上でごろごろするのが好きだ。熱い議論が繰り広げられた。厚紙でしおりを作ってみた。熱伝導率の高い素材が使われている。厚切りのハムがサンドイッチにぴったり。熱気に包まれた会場が活気に満ちている。厚いスライスのケーキが食べ応えがある。熱を逃がさないための工夫が必要だ。厚手の毛布が寒さから守ってくれる。熱々のピザを頬張る瞬間が最高だ。厚いカーテンが日差しを遮る。熱中すると時間が経つのを忘れる。厚みのあるチーズがパスタに絡む。熱帯雨林の生態系に興味がある。厚かましくもお願いしてしまった。熱々のコーヒーをゆっくりと飲む。厚さがある板を切るのは難しい。熱風が吹き荒れる砂漠を旅する。厚い紙にペンでイラストを描いた。熱意を持ってプロジェクトに取り組む。厚手のコートを着込む季節が来た。熱心に研究に取り組む科学者たち。厚い氷が溶け始めている。熱中して読んでいた本が面白かった。厚かましい態度が気になる。熱々のスープで温まりたい。厚切りトマトがサラダに乗っている。熱帯雨林の中で動物たちが生き生きとしている。厚さを感じさせない軽いデザイン。熱い石の上に水をかけて蒸気を楽しむ。厚い氷が湖を覆っている。熱気にあふれたライブが行われている。厚い防寒着が役立つ冬山登山。熱心なファンが選手に声援を送る。厚い靴下で足元を暖かく保つ。熱湯を使って安全に調理する方法を学ぶ。厚手のシャツが肌寒い日にぴったり。熱心に聞いてくれる人がいると嬉しい。厚切りベーコンが朝食にぴったりだ。熱を感じる夕暮れの風景が美しい。厚生年金制度について学ぶ機会があった。熱い鉄板で焼いたお好み焼きが美味しい。厚い書類をファイルに綺麗に整理する。熱心に練習を繰り返すミュージシャン。厚化粧のキャラクターが印象的だった。熱風にさらされながら歩くのは辛い。厚みのある財布が重たく感じる。熱中症対策として帽子をかぶる。厚い氷が溶け出す音が聞こえる。熱心にプレゼンをするビジネスマン。厚生年金に加入していることが重要だ。熱意を込めた手紙が届いた。厚手のカーテンで冷気を遮る。熱気がこもって窓を開けたくなる。厚紙でできた模型を作るのが趣味だ。熱々の焼きたてパンが食卓に並んだ。厚い雲が空を覆っている日が続く。熱を発するデバイスを冷やす方法を探している。厚い殻を持つ貝が強くて丈夫だ。熱意あふれる講演会に参加した。厚生労働省が新しい政策を発表した。"

  val isFinishedVar = Var(false)

  span(
      child <-- isFinishedVar.signal.map { isFinished =>
        if gooAppId.nonEmpty && isFinished then
          gameView(gooAppId, chainLen, toLearnText)
        else
          startScreen(appIdSetter = gooAppId = _, chainLenSetter = chainLen = _,
              toLearnTextSetter = toLearnText = _, isFinishedVar.set(true))
      }
  )

def startScreen(
    appIdSetter: String => Unit,
    chainLenSetter: Int => Unit,
    toLearnTextSetter: String => Unit,
    isFinishedSetter: => Unit
) =
  div(
      cls := "flex flex-col items-center justify-center h-screen bg-gray-800",
      h1(
          cls := "text-5xl font-bold mb-6 text-center text-white",
          "AtsusugiDa"
      ),
      form(
          cls := "flex flex-col items-center",
          input(
              cls := "p-2 border border-gray-600 rounded-md mb-4",
              placeholder := "gooのapp_id",
              onInput.mapToValue --> appIdSetter
          ),
          input(
              cls := "p-2 border border-gray-600 rounded-md mb-4",
              placeholder := "文字の長さ（初期値10）",
              onInput.mapToValue --> { _.toIntOption.foreach(chainLenSetter) }
          ),
          textArea(
              cls := "p-2 border border-gray-600 rounded-md mb-4",
              placeholder := "カスタム学習データ",
              onInput.mapToValue --> toLearnTextSetter
          ),
          button(
              cls := "px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",
              "Start",
              onClick --> { e =>
                e.preventDefault()
                isFinishedSetter
              }
          )
      )
  )
